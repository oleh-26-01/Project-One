<UserControl x:Class="Project_One.Controls.ThirdTopPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:viewModels="clr-namespace:Project_One.ViewModels"
             mc:Ignorable="d"
             d:DesignHeight="33" d:DesignWidth="1010">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Themes/GlobalStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <!-- Removed local ButtonStyle and LabelStyle -->
            <DataTemplate x:Key="EvolutionTemplate" DataType="{x:Type viewModels:EvolutionViewModel}">
                <Grid ShowGridLines="False">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="0.75*" />
                        <ColumnDefinition Width="2.25*" />
                    </Grid.ColumnDefinitions>
                    <Border Grid.Column="0" Style="{StaticResource BaseBorderStyle}">
                        <Grid x:Name="ControlGrid" Background="{StaticResource ListItemBackgroundBrush}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition />
                                <ColumnDefinition />
                                <ColumnDefinition />
                            </Grid.ColumnDefinitions>

                            <Button Grid.Column="0" x:Name="ActionButton"
                                    Style="{StaticResource BaseButtonStyle}"
                                    Content="{Binding ActionButtonContext}" 
                                Background="{Binding ActionButtonBackground}"/>
                            <Button Grid.Column="1" x:Name="SaveButton"
                                    Style="{StaticResource ConstructiveButtonStyle}"
                                    Content="Save" />
                            <Button Grid.Column="2" x:Name="ResetButton"
                                    Style="{StaticResource DestructiveButtonStyle}"
                                    Content="Reset" />
                        </Grid>
                    </Border>
                    <Border Grid.Column="1" Style="{StaticResource BaseBorderStyle}">
                        <Grid x:Name="InfoGrid" Background="{StaticResource ListItemBackgroundBrush}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition />
                                <ColumnDefinition />
                                <ColumnDefinition />
                                <ColumnDefinition />
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" x:Name="ProgressLabel" 
                                       Style="{StaticResource BaseTextBlockStyle}"
                                       Text="{Binding ProgressInfo}" 
                                       HorizontalAlignment="Center"/>
                            <TextBlock Grid.Column="1" x:Name="CurrentValueLabel" 
                                       Style="{StaticResource BaseTextBlockStyle}"
                                       Text="{Binding CurrentValueInfo}" 
                                       ToolTip="{Binding ValueToolTip}"
                                       HorizontalAlignment="Center"/>
                            <TextBlock Grid.Column="2" x:Name="TimeSpendLabel" 
                                       Style="{StaticResource BaseTextBlockStyle}"
                                       Text="{Binding TimeSpendInfo}" 
                                       HorizontalAlignment="Center"/>
                            <TextBlock Grid.Column="3" x:Name="SaveValueLabel" 
                                       Style="{StaticResource BaseTextBlockStyle}"
                                       Text="{Binding SaveValueInfo}" 
                                       ToolTip="{Binding ValueToolTip}"
                                       HorizontalAlignment="Center"/>
                        </Grid>
                    </Border>
                </Grid>
            </DataTemplate>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid ShowGridLines="False" Background="{StaticResource PrimaryBrush}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="1.5*" />
            <ColumnDefinition Width="7*" />
        </Grid.ColumnDefinitions>

        <Grid Grid.Column="0" Background="{StaticResource ListItemBackgroundBrush}" Margin="0,0,1,0">
            <CheckBox x:Name="FollowCarCheckBox" 
                      Style="{StaticResource BaseCheckBoxStyle}"
                      Content="Follow Car" IsChecked="True"
                      FlowDirection="RightToLeft"
                      HorizontalAlignment="Center" 
                      VerticalContentAlignment="Center" />
        </Grid>
        <Grid Grid.Column="1">
            <ContentControl ContentTemplate="{StaticResource EvolutionTemplate}">
                <viewModels:EvolutionViewModel/>
            </ContentControl>
        </Grid>
    </Grid>
</UserControl>